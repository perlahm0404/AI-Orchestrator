{
  "version": "3.0",
  "project": "credentialmate",
  "adr": "ADR-001",
  "last_updated": "2026-01-09T00:00:00Z",
  "updated_by": "app-advisor",

  "summary": {
    "total": 15,
    "pending": 15,
    "in_progress": 0,
    "completed": 0,
    "blocked": 0
  },

  "phases": [
    {
      "phase": 1,
      "name": "Foundation & Infrastructure",
      "description": "Set up database schema, infrastructure dependencies, and core architecture"
    },
    {
      "phase": 2,
      "name": "Backend API Development",
      "description": "Build API endpoints, Celery workers, and report generation logic"
    },
    {
      "phase": 3,
      "name": "Frontend Integration",
      "description": "Build UI components and integrate with backend API"
    },
    {
      "phase": 4,
      "name": "Testing & HIPAA Compliance",
      "description": "Comprehensive testing, security audit, and compliance verification"
    }
  ],

  "tasks": [
    {
      "id": "TASK-ADR001-001",
      "adr": "ADR-001",
      "title": "Create database migration for report_jobs and report_access_logs tables",
      "description": "Create Alembic migration file (001_add_report_generation_tables.py) with:\n- report_jobs table (id, user_id, provider_id, report_type, format, status, filters, s3_key, error_message, timestamps, record_count, file_size_bytes)\n- report_access_logs table (id, job_id, user_id, action, ip_address, user_agent, timestamp)\n- Appropriate indexes\n- Foreign key constraints with CASCADE",
      "type": "migration",
      "agent": "manual",
      "status": "pending",
      "priority": "P0",
      "dependencies": [],
      "estimated_files": 1,
      "phase": 1,
      "tags": ["database", "migration", "hipaa-sensitive"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 15,
      "completion_promise": "MIGRATION_COMPLETE",
      "files": [
        "alembic/versions/001_add_report_generation_tables.py"
      ]
    },
    {
      "id": "TASK-ADR001-002",
      "adr": "ADR-001",
      "title": "Add backend dependencies for report generation",
      "description": "Update requirements.txt with:\n- reportlab (PDF generation)\n- openpyxl (Excel generation, optional phase 2)\n- celery[redis] (async workers)\n- boto3 (S3 uploads)\nRun pip install to verify compatibility",
      "type": "feature",
      "agent": "manual",
      "status": "pending",
      "priority": "P0",
      "dependencies": [],
      "estimated_files": 1,
      "phase": 1,
      "tags": ["dependencies", "infrastructure"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 10,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "requirements.txt"
      ]
    },
    {
      "id": "TASK-ADR001-003",
      "adr": "ADR-001",
      "title": "Create S3 bucket with lifecycle policy and KMS encryption",
      "description": "Infrastructure setup (manual or Terraform):\n- Create S3 bucket: credentialmate-reports-{env}\n- Enable KMS encryption at rest\n- Set lifecycle policy: auto-delete objects after 24 hours\n- Configure CORS for signed URL downloads\n- Set bucket policy: deny unencrypted uploads\nDocument bucket name in .env.example",
      "type": "feature",
      "agent": "manual",
      "status": "pending",
      "priority": "P0",
      "dependencies": [],
      "estimated_files": 2,
      "phase": 1,
      "tags": ["infrastructure", "aws", "security", "hipaa-required"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 10,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        ".env.example",
        "docs/infrastructure-setup.md"
      ]
    },
    {
      "id": "TASK-ADR001-004",
      "adr": "ADR-001",
      "title": "Create Pydantic schemas for report generation",
      "description": "Create apps/backend-api/app/schemas/reports.py with:\n- ReportGenerateRequest (filters, format, include_sections)\n- ReportJobResponse (job_id, status, progress_percentage, download_url, expires_at)\n- ReportFilters (urgency_levels, date_range, provider_ids)\n- ReportFormat enum (pdf, csv, excel)\n- ReportStatus enum (queued, processing, completed, failed)\nInclude validation logic and examples",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-001"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "schemas", "validation"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/backend-api/app/schemas/reports.py"
      ]
    },
    {
      "id": "TASK-ADR001-005",
      "adr": "ADR-001",
      "title": "Create SQLAlchemy models for report_jobs and report_access_logs",
      "description": "Create apps/backend-api/app/models/report.py with:\n- ReportJob model (matches schema from migration)\n- ReportAccessLog model (matches schema from migration)\n- Relationship definitions\n- Helper methods: is_expired(), can_download(), mark_accessed()\nEnsure HIPAA-sensitive fields are properly marked",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-001"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "models", "database", "hipaa-sensitive"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/backend-api/app/models/report.py"
      ]
    },
    {
      "id": "TASK-ADR001-006",
      "adr": "ADR-001",
      "title": "Create report generation API routes",
      "description": "Create apps/backend-api/app/api/v1/reports/routes.py with:\n- POST /api/v1/reports/at-risk (initiate report)\n- GET /api/v1/reports/jobs/{job_id} (check status)\n- GET /api/v1/reports/jobs (list user's reports)\nInclude:\n- Authentication checks (require provider role)\n- Rate limiting (10 reports/hour per user)\n- HIPAA audit logging for all endpoints\n- Input validation",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-004", "TASK-ADR001-005"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "api", "routes", "hipaa-required"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/backend-api/app/api/v1/reports/routes.py"
      ]
    },
    {
      "id": "TASK-ADR001-007",
      "adr": "ADR-001",
      "title": "Create report service layer with business logic",
      "description": "Create apps/backend-api/app/services/reports.py with:\n- create_report_job() - Creates DB record, enqueues Celery task\n- get_report_status() - Fetches job status with download URL\n- list_user_reports() - Returns paginated report history\n- generate_signed_url() - Creates time-limited S3 URL (5 min expiry)\n- log_report_access() - HIPAA audit trail\nInclude error handling and transaction management",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-005"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "services", "business-logic"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/backend-api/app/services/reports.py"
      ]
    },
    {
      "id": "TASK-ADR001-008",
      "adr": "ADR-001",
      "title": "Create Celery task for report generation",
      "description": "Create apps/worker-tasks/tasks/generate_report.py with:\n- generate_at_risk_report() Celery task\n- Query credentials with urgency filters (at_risk, urgent)\n- Stream results in chunks (500 records at a time)\n- Call PDF/CSV builder based on format\n- Upload to S3 with encryption\n- Update job status (processing → completed/failed)\n- Progress updates via Celery self.update_state()\n- Timeout handling (max 5 minutes)\nEnsure all PHI queries are logged",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-007"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "celery", "async", "hipaa-sensitive"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/worker-tasks/tasks/generate_report.py"
      ]
    },
    {
      "id": "TASK-ADR001-009",
      "adr": "ADR-001",
      "title": "Create PDF report builder",
      "description": "Create apps/worker-tasks/builders/pdf_builder.py with:\n- build_at_risk_pdf() function\n- ReportLab templates:\n  - Executive summary (counts, urgency breakdown)\n  - Credential details table (name, type, expiry, status)\n  - Action recommendations section\n- Styling: Headers, watermarks ('CONFIDENTIAL - HIPAA PROTECTED')\n- Color-coded urgency indicators (red=urgent, yellow=at_risk)\n- Page numbers, timestamps, provider info\nStream data to avoid memory issues on large reports",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-002"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "pdf", "reportlab"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/worker-tasks/builders/pdf_builder.py"
      ]
    },
    {
      "id": "TASK-ADR001-010",
      "adr": "ADR-001",
      "title": "Create CSV report builder",
      "description": "Create apps/worker-tasks/builders/csv_builder.py with:\n- build_at_risk_csv() function\n- Columns: Provider Name, Credential Type, Credential Number, Issue Date, Expiry Date, Status, Urgency Level, Days Until Expiry, Action Required\n- Include summary header rows (total count, urgency breakdown)\n- Proper CSV escaping for special characters\n- Stream writing for large datasets\nEnsure UTF-8 encoding",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-002"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "csv"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/worker-tasks/builders/csv_builder.py"
      ]
    },
    {
      "id": "TASK-ADR001-011",
      "adr": "ADR-001",
      "title": "Create S3 upload utility with encryption",
      "description": "Create apps/worker-tasks/utils/s3_uploader.py with:\n- upload_report() function\n- KMS encryption enforcement\n- Content-Type headers based on format\n- Content-Disposition: attachment; filename=...\n- Generate S3 key: reports/{user_id}/{job_id}/{filename}\n- Error handling and retries\n- Validate upload success\nEnsure no unencrypted uploads are possible",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-003"],
      "estimated_files": 1,
      "phase": 2,
      "tags": ["backend", "s3", "encryption", "hipaa-required"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/worker-tasks/utils/s3_uploader.py"
      ]
    },
    {
      "id": "TASK-ADR001-012",
      "adr": "ADR-001",
      "title": "Create React ReportDownloader component",
      "description": "Create apps/frontend-web/src/components/reports/ReportDownloader.tsx with:\n- Format selector (PDF/CSV radio buttons)\n- Date range picker (start/end dates)\n- Urgency level checkboxes (Urgent, At Risk)\n- Provider selector (if admin, multi-select)\n- 'Generate Report' button\n- Loading state during generation\n- Success/error notifications\n- TypeScript types\n- Accessible form controls (labels, ARIA)\nIntegrate with react-hook-form for validation",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-006"],
      "estimated_files": 1,
      "phase": 3,
      "tags": ["frontend", "react", "typescript", "ui"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/frontend-web/src/components/reports/ReportDownloader.tsx"
      ]
    },
    {
      "id": "TASK-ADR001-013",
      "adr": "ADR-001",
      "title": "Create React job status polling hook",
      "description": "Create apps/frontend-web/src/hooks/useReportJobStatus.ts with:\n- useReportJobStatus(jobId) custom hook\n- Polling logic: fetch status every 2 seconds\n- Stop polling when status = completed/failed\n- Progress percentage display\n- Auto-download when complete (window.location.href = download_url)\n- Cleanup on unmount\n- Error handling and retry logic\nUse react-query for caching and state management",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P1",
      "dependencies": ["TASK-ADR001-012"],
      "estimated_files": 1,
      "phase": 3,
      "tags": ["frontend", "react", "hooks", "polling"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/frontend-web/src/hooks/useReportJobStatus.ts"
      ]
    },
    {
      "id": "TASK-ADR001-014",
      "adr": "ADR-001",
      "title": "Create React ReportHistory component",
      "description": "Create apps/frontend-web/src/components/reports/ReportHistory.tsx with:\n- Table showing recent reports (last 10)\n- Columns: Report Type, Format, Generated At, Expires At, Status, Actions\n- Re-download button (if not expired)\n- Expiration countdown timer\n- Status badges (completed/failed/processing)\n- Empty state handling\n- Pagination (if needed)\n- TypeScript types\nIntegrate with react-query for data fetching",
      "type": "feature",
      "agent": "FeatureBuilder",
      "status": "pending",
      "priority": "P2",
      "dependencies": ["TASK-ADR001-006"],
      "estimated_files": 1,
      "phase": 3,
      "tags": ["frontend", "react", "typescript", "ui"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 50,
      "completion_promise": "FEATURE_COMPLETE",
      "files": [
        "apps/frontend-web/src/components/reports/ReportHistory.tsx"
      ]
    },
    {
      "id": "TASK-ADR001-015",
      "adr": "ADR-001",
      "title": "Write comprehensive tests for report generation system",
      "description": "Create test files:\n1. tests/api/test_reports.py - API endpoint tests\n   - Test POST /reports/at-risk with valid/invalid inputs\n   - Test GET /reports/jobs/{id} with different statuses\n   - Test authentication/authorization\n   - Test rate limiting\n2. tests/workers/test_generate_report.py - Celery task tests\n   - Test PDF generation with mock data\n   - Test CSV generation with mock data\n   - Test S3 upload with mocks\n   - Test error handling\n3. tests/integration/test_report_flow.py - End-to-end test\n   - Create job → poll status → download report\n   - Verify audit logs created\n   - Verify S3 object exists and is encrypted\nTarget: 90% coverage (L1 requirement)",
      "type": "test",
      "agent": "TestWriter",
      "status": "pending",
      "priority": "P0",
      "dependencies": ["TASK-ADR001-006", "TASK-ADR001-008", "TASK-ADR001-009", "TASK-ADR001-010"],
      "estimated_files": 3,
      "phase": 4,
      "tags": ["testing", "pytest", "coverage", "hipaa-required"],
      "created_at": "2026-01-09T00:00:00Z",
      "started_at": null,
      "completed_at": null,
      "blocked_at": null,
      "blocked_reason": null,
      "iterations": 0,
      "max_iterations": 15,
      "completion_promise": "TESTS_COMPLETE",
      "files": [
        "tests/api/test_reports.py",
        "tests/workers/test_generate_report.py",
        "tests/integration/test_report_flow.py"
      ]
    }
  ],

  "notes": {
    "hipaa_compliance_checklist": [
      "✅ Audit logging for all PHI access (report_access_logs table)",
      "✅ Encryption at rest (S3 + KMS)",
      "✅ Encryption in transit (HTTPS, signed URLs)",
      "✅ Time-limited access (5 min URL expiry, 24hr auto-delete)",
      "✅ Role-based access control (provider role required)",
      "✅ Rate limiting to prevent mass downloads",
      "⚠️ Manual review required: Security audit before prod deploy"
    ],
    "infrastructure_requirements": [
      "Redis instance for Celery queue",
      "S3 bucket with KMS encryption + lifecycle policy",
      "Celery worker process (separate from API)",
      "Environment variables: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, S3_BUCKET_NAME, KMS_KEY_ID, REDIS_URL"
    ],
    "deployment_order": [
      "1. Apply database migration (TASK-001)",
      "2. Deploy infrastructure (Redis, S3) (TASK-002, TASK-003)",
      "3. Deploy backend API + workers (TASK-004 to TASK-011)",
      "4. Deploy frontend (TASK-012 to TASK-014)",
      "5. Run integration tests (TASK-015)",
      "6. HIPAA security review (manual)",
      "7. Production deployment"
    ]
  }
}
