# CredentialMate Adapter Configuration
#
# Project-specific settings for CredentialMate.
# L1 autonomy due to HIPAA compliance requirements.
#
# Governance Authority: MissionControl
# Constitutional Principles: /Users/tmac/1_REPOS/MissionControl/governance/capsule/
# Global Policies: /Users/tmac/1_REPOS/MissionControl/governance/policies/
#
# Structure:
#   /Users/tmac/1_REPOS/credentialmate/
#   ├── apps/backend-api/    (FastAPI, Python)
#   ├── apps/frontend-web/   (Next.js, TypeScript)
#   ├── apps/rules-engine/   (CME rules)
#   ├── apps/worker-tasks/   (Celery workers)
#   └── tests/               (Pytest)

# MissionControl governance integration
governance:
  authority: MissionControl
  capsule_path: /Users/tmac/1_REPOS/MissionControl/governance/capsule/
  policies_path: /Users/tmac/1_REPOS/MissionControl/governance/policies/
  # Policies to load (in addition to adapter-specific rules)
  policies:
    - database-safety.md
    - security.md
    - governance.md

project:
  name: credentialmate
  path: /Users/tmac/1_REPOS/credentialmate
  language: python  # Primary backend language (also has TypeScript frontend)

commands:
  # Run from project root - these match Makefile targets
  lint: "ruff check apps/backend-api apps/worker-tasks apps/rules-engine"
  typecheck: "mypy apps/backend-api"
  test: "pytest tests/ -v"
  coverage: "pytest tests/ --cov=apps/backend-api --cov-report=xml"
  # Frontend commands (optional, secondary)
  frontend_lint: "cd apps/frontend-web && npm run lint"
  frontend_typecheck: "cd apps/frontend-web && npm run typecheck"

# Scanner-specific commands (for bug discovery via Docker)
scanner_commands:
  lint: "/usr/local/bin/docker exec credmate-backend-dev ruff check apps/backend-api apps/worker-tasks apps/rules-engine --output-format=json"
  typecheck: "/usr/local/bin/docker exec credmate-backend-dev mypy apps/backend-api/src --show-error-codes --no-error-summary"
  test: "/usr/local/bin/docker exec credmate-backend-dev pytest tests/ -v --tb=short"
  guardrails: "/usr/local/bin/docker exec credmate-backend-dev rg '# type: ignore|# noqa|@pytest.mark.skip|\\.only\\(|\\.skip\\(' apps/backend-api apps/worker-tasks apps/rules-engine --json"

paths:
  source:
    - "apps/backend-api/"
    - "apps/worker-tasks/"
    - "apps/rules-engine/"
    - "apps/frontend-web/src/"
  tests:
    - "tests/"
  coverage_report: "coverage.xml"

# L1 = Stricter autonomy (HIPAA compliance)
autonomy_level: L1

# Stricter thresholds for HIPAA
thresholds:
  coverage_minimum: 90
  max_lines_added: 50      # Smaller changes for review
  max_files_changed: 3     # Fewer files per task

# Additional HIPAA-specific checks
hipaa:
  enabled: true
  phi_patterns:
    - "patient"
    - "medical"
    - "health"
    - "diagnosis"
    - "ssn"
    - "dob"
    - "address"
  audit_all_data_access: true
  # Files that require extra scrutiny
  sensitive_paths:
    - "apps/backend-api/app/models/"
    - "apps/backend-api/app/api/"
    - "alembic/versions/"

# Guardrail patterns specific to CredentialMate
guardrails:
  forbidden_patterns:
    - "# type: ignore"
    - "# noqa"
    - "pragma: no cover"
    - "@pytest.mark.skip"
    - ".only()"
  # Database safety - matches existing 5-layer defense
  database_forbidden:
    - "DROP TABLE"
    - "TRUNCATE"
    - "DELETE FROM"  # Must use soft delete
